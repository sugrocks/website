var tock,episodeList=[],nextEp=null,dontTick=!1;function CodeNotOK(e){this.code=e,this.message="The response code is not OK",this.toString=function(){return this.message+": "+this.code}}function startClock(){new Promise(function(e,t){var n=(new Date).getTime();if(episodeList.some(function(e,t,o){if(n<e.dateEnd.getTime())return nextEp=e,!0}))e(nextEp),document.getElementById("container").classList.remove("hiatus");else{dontTick=!0,nextEp=null;var o=(new Date).getTime()-episodeList[episodeList.length-1].dateEnd,d=Math.floor(o/864e5);o-=864e5*d;var i=Math.floor(o/36e5);clearCountdown(),document.getElementById("container").className="hiatus",document.getElementById("title").innerHTML="Steven Universe Future",document.getElementById("code").innerHTML="",document.getElementById("hours").innerHTML="ended",document.getElementById("status").innerHTML="(It's been "+d+" days and "+i+" hours.)"}}).then(function(e){var t="";e.leaked?t="(but already online)":e.supposed?t="(supposed)":e.unknown&&(clearCountdown(),document.getElementById("hours").innerHTML="Unknown Date",dontTick=!0),document.getElementById("title").innerHTML=e.title,document.getElementById("code").innerHTML=" ["+e.code+"]",document.getElementById("status").innerHTML=t,dontTick||(tick(),tock=setInterval(function(){tick()},1e3))})}function clearCountdown(){document.getElementById("days").innerHTML="",document.getElementById("minutes").innerHTML="",document.getElementById("seconds").innerHTML=""}function pad(e){return e<10?"0"+e:e}function getDiff(e){var t,n=e-(new Date).getTime(),o=Math.floor(n/864e5);t=1===o?"1 day ":o>0?o+" days ":"",n-=864e5*o;var d=Math.floor(n/36e5);n-=36e5*d;var i=Math.floor(n/6e4);n-=6e4*i;var a=Math.floor(n/1e3);return{d:t,h:pad(d)+":",m:pad(i),s:":"+pad(a)}}function formatDate(e){if("undefined"!=typeof Intl)return e.toLocaleString(navigator.language,{weekday:"short",day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});var t=["Su","Mo","Tu","We","Th","Fr","Sa"][e.getDay()]+". "+e.getFullYear()+"-"+pad(e.getMonth()+1)+"-";return t+=pad(e.getDate())+" "+pad(e.getHours())+":"+pad(e.getMinutes())}function tick(){var e=(new Date).getTime();if(e>nextEp.dateEnd.getTime())clearInterval(tock),startClock();else if(e>nextEp.dateObj.getTime())clearCountdown(),document.getElementById("hours").innerHTML="LIVE!";else{var t=getDiff(nextEp.dateObj);document.getElementById("days").innerHTML=t.d,document.getElementById("hours").innerHTML=t.h,document.getElementById("minutes").innerHTML=t.m,document.getElementById("seconds").innerHTML=t.s}}function getList(){if(null!=nextEp){var e=(new Date).getTime(),t="";episodeList.forEach(function(n){if(e<n.dateObj.getTime()){var o=getDiff(n.dateObj);t+=n.title+" ("+n.code+")",n.unknown||n.leaked||(t+="\n"+o.d+o.h+o.m,t+="\n"+formatDate(n.dateObj),n.supposed&&(t+="\n(supposed)")),t+="\n\n"}}),window.alert(t)}else window.alert("No new episodes")}window.fetch("https://sug.rocks/countdown/episodes.json?"+Math.floor(1e4*Math.random()+1)).then(function(e){if(e.ok)return e.json();throw new CodeNotOK(e.status)}).catch(function(e){document.getElementById("hours").innerHTML="Can't load shit",console.error(e)}).then(function(e){e.forEach(function(e){var t=new Date(0);t.setUTCFullYear(e.year),t.setUTCMonth(e.month-1),t.setUTCDate(e.day),t.setUTCHours(e.hour),t.setUTCMinutes(e.minute),e.dateObj=t,e.dateEnd=new Date(t.getTime()+60*e.duration*1e3),episodeList.push(e)}),startClock()});